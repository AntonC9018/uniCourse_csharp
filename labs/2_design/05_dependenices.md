# Лабораторная работа 5

- Тема: **Зависимости абстракций**.
- Видео пока нет
- [PR](https://github.com/AntonC9018/uniCourse_csharp/pull/9)

## Концепты

- Виды абстракций: переменная, функция, класс, модуль.
- Инкапсуляция операций и инкапсуляция данных.
- Виды зависимостей функций: прямые параметры, конфигурация, сервисы.
- Инкапсуляция зависимостей: структура зависимостей, контекст, сервис.
- Принципы dependency inversion и dependency injection.
- Использование DI контейнера.
- Создание сервисов с инкапсуляцией их зависимостей через фабрики.
- Различные реализации абстракции: интерфейс (открытый вариант, стратегия), tagged union (закрытый вариант).
- Принцип Single Responsibility.


## Практика

Требуется реализовать систему, которая будет способна:
1. Считывать данные из разных источников, как минимум 2
   (файл, данные с HTTP запроса, случайно сгенерированные налету, база данных).
2. Обработать их определенным образом 
   (обновить определенные поля по правилу, отсортировать в определенном порядке).
3. Сохранять данные в другой источник, в другом формате. 
4. Поддержка форматов, 2 из: JSON, CSV, Excel, просто текст для просмотра.

При это необходимо соблюдать принцип Single Responsibility.

Требования к устройству системы:
- Формат должен задаваться используя tagged union над контекстом, необходимым для сериализации.
  Для этого сделайте свой отдельный (не обобщенный), или используйте библиотеку (обобщенный тип).
- Различные источники реализуйте своим интерфейсом `SourceReader`.
- Различные выходные источники реализуйте через свой интерфейс `SourceWriter`.
- Сделайте 2 обычные статических функций для преобразования данных на основе `IEnumerable<>`.
  Функции должны принимать свои зависимости параметрами.
  Сгруппируйте их параметры в структуру с параметрами.
- По необходимости, реализуйте адаптеры (классовую обертку) для этих функций 
  для будущего использования в DI контейнере.
- Сделайте несколько сервисов дирижера, которые сохраняют шаги как зависимости в поля,
  и имеют метод для их выполнения.
  Вместо этого также можно реализовать паттерн pipelines, создав интерфейс для шагов преобразования.
- Создайте функцию для выполнения всей цепочки (включая чтение и вписывание).
  Оберните ее в сервис.
- Используйте DI контейнер для создания сервиса выполнения всей цепочки.
  Тут 3 подхода:
  1. Стройте новый контейнер при попытке выполнить конкретную цепочку (проще).
  2. Используйте паттерн "фабрика" для создания нужного сервиса ([см. инфу](https://code-maze.com/dotnet-factory-pattern-dependency-injection)) 
     и передавайте необходимую конфигурацию сервису оркестратора, который выберет нужные имплементации 
     `SourceReader`, `SourceWriter` и т.д. (Постарайтесь соблюсти SRP)
  3. Задайте конфигурацию, используя scope DI контейнера, и смотрите ее в фабриках.
     ([Инфа](https://medium.com/%40serasiyasavan14/understanding-the-ambient-context-pattern-in-net-from-theory-to-production-2eb9ae7eab17).)


Пример приложения можете найти в папке [/examples/lab5_example](../../examples/lab5_example).